<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–π–º–µ—Ä —ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/icon-192x192.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #1c1c1e;
            color: white;
        }
        #counter {
            font-size: 128px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        #lightning {
            font-size: 128px;
            display: inline-block;
            transition: transform 0.2s;
        }
        #timer, #stopwatch {
            font-size: 64px;
            margin-bottom: 20px;
            display: block;
        }
        #stopwatch {
            font-size: 15px;
            margin-top: 15px;
        }
        .hidden {
            display: none;
        }
        #api-key-display {
            position: fixed;
            bottom: 50px;
            background-color: #2c2c2e;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            color: #ffffff;
            opacity: 0.9;
        }
        #regenerate-key {
            cursor: pointer;
            margin-left: 10px;
            font-size: 18px;
            color: white;
        }
    </style>
</head>
<body>

    <div>
        <span id="lightning">‚ö°</span>
        <span id="counter" contenteditable="true">0</span>
    </div>
    <div id="timer">–ù–∞—Å—Ç—É–ø–Ω–µ: 2:00</div>
    <div id="stopwatch">–°–µ–∫—É–Ω–¥–æ–º—ñ—Ä: 0:00</div>

    <!-- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è API –∫–ª—é—á–∞ —Å–µ—Å—ñ—ó -->
    <div id="api-key-display">
        <span id="api-key">API Key: </span>
        <span id="regenerate-key">üîÑ</span> <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–ª—é—á–∞ -->
    </div>

    <script>
    let number = 0;
    const maxNumber = 100;
    const incrementInterval = 120000; // 2 —Ö–≤–∏–ª–∏–Ω–∏
    const notificationDelay = 200 * 60 * 1000; // 200 —Ö–≤–∏–ª–∏–Ω —É –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö
    let stopwatchStartTime = Date.now();
    let stopwatchInterval;
    let notificationSent = false;
    let notificationTimeout; // –¢–∞–π–º–∞—É—Ç –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

    // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–±–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è API –∫–ª—é—á–∞ —Å–µ—Å—ñ—ó
    function getApiKey() {
        let apiKey = localStorage.getItem('apiKey'); // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ localStorage –¥–ª—è –ø–æ—Å—Ç—ñ–π–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è
        if (!apiKey) {
            apiKey = generateApiKey(); // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞, —è–∫—â–æ –Ω–µ–º–∞—î —ñ—Å–Ω—É—é—á–æ–≥–æ
            localStorage.setItem('apiKey', apiKey); // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ localStorage
        }
        return apiKey;
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–æ—Å—Ç–æ–≥–æ API –∫–ª—é—á–∞
    function generateApiKey() {
        return 'api_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è API –∫–ª—é—á–∞ –≤–Ω–∏–∑—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    function displayApiKey() {
        const apiKey = getApiKey();
        document.getElementById('api-key').innerText = `API Key: ${apiKey}`;
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ localStorage
    function loadFromLocalStorage() {
        const savedNumber = localStorage.getItem('counter');
        const savedStartTime = localStorage.getItem('startTime');
        const savedNotificationSent = localStorage.getItem('notificationSent');

        if (savedNumber) {
            number = parseInt(savedNumber, 10);
            document.getElementById("counter").innerText = number;
        }

        if (savedStartTime) {
            stopwatchStartTime = parseInt(savedStartTime, 10);
        }

        if (savedNotificationSent) {
            notificationSent = savedNotificationSent === 'true';
        }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É localStorage
    function saveToLocalStorage() {
        localStorage.setItem('counter', number);
        localStorage.setItem('startTime', stopwatchStartTime);
        localStorage.setItem('notificationSent', notificationSent.toString());
    }

    // –û–Ω–æ–≤–ª—é—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ —ñ —Ç–∞–π–º–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å–µ–∫—É–Ω–¥–æ–º—ñ—Ä–∞
    function updateNumberAndTimer() {
        const elapsedTime = Date.now() - stopwatchStartTime;
        const increments = Math.floor(elapsedTime / incrementInterval);
        number = Math.min(increments, maxNumber);
        document.getElementById("counter").innerText = number;

        const timeToNextIncrement = incrementInterval - (elapsedTime % incrementInterval);
        document.getElementById("timer").innerText = `${formatTime(Math.ceil(timeToNextIncrement / 1000))}`;

        if (number >= maxNumber) {
            document.getElementById("timer").classList.add("hidden");
            document.getElementById("stopwatch").classList.add("hidden");

            // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ª–∏—à–µ –æ–¥–∏–Ω —Ä–∞–∑, –∫–æ–ª–∏ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è 100
            if (!notificationSent) {
                clearTimeout(notificationTimeout); // –°–∫–∞—Å–æ–≤—É—î–º–æ —Ç–∞–π–º–∞—É—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                sendNotification();
                notificationSent = true; // –ó–º—ñ–Ω—é—î–º–æ —Ñ–ª–∞–≥, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                saveToLocalStorage(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω
            }
        } else {
            document.getElementById("timer").classList.remove("hidden");
            document.getElementById("stopwatch").classList.remove("hidden");
        }

        document.getElementById("stopwatch").innerText = `–°–µ–∫—É–Ω–¥–æ–º—ñ—Ä: ${Math.floor(elapsedTime / 60000)}:${String(Math.floor(elapsedTime / 1000) % 60).padStart(2, '0')}`;
        saveToLocalStorage(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ
    }

    // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É —É —Ñ–æ—Ä–º–∞—Ç—ñ mm:ss
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${String(minutes).padStart(1, '0')}:${String(secs).padStart(2, '0')}`;
    }

    // –°–∫–∏–¥–∞–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
    document.getElementById("lightning").addEventListener("click", () => {
        number = 0; // –°–∫–∏–¥–∞—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫
        document.getElementById("counter").innerText = number;

        // –û–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å –∑–∞–ø—É—Å–∫—É —Å–µ–∫—É–Ω–¥–æ–º—ñ—Ä–∞
        stopwatchStartTime = Date.now();
        notificationSent = false; // –î–æ–∑–≤–æ–ª—è—î–º–æ –≤—ñ–¥–ø—Ä–∞–≤–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–Ω–æ–≤—É –ø—Ä–∏ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—ñ 100
        startNotificationTimer(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–∞–π–º–µ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        saveToLocalStorage(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω
        location.reload(); // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É
    });

    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    function sendNotification() {
        if ('serviceWorker' in navigator && 'PushManager' in window) {
            navigator.serviceWorker.ready.then(function(registration) {
                registration.showNotification('–î–æ—Å—è–≥–Ω—É—Ç–æ 100 –µ–Ω–µ—Ä–≥—ñ—ó!', {
                    body: '–õ—ñ—á–∏–ª—å–Ω–∏–∫ –¥–æ—Å—è–≥ 100!',
                    icon: '/icon-192x192.png',
                    badge: '/icon-192x192.png'
                });
            });
        }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø—É—Å–∫—É —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ 200 —Ö–≤–∏–ª–∏–Ω
    function startNotificationTimer() {
        clearTimeout(notificationTimeout); // –°–∫–∞—Å–æ–≤—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∞–π–º–∞—É—Ç
        notificationTimeout = setTimeout(() => {
            sendNotification();
        }, notificationDelay); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –Ω–æ–≤–∏–π —Ç–∞–π–º–∞—É—Ç –Ω–∞ 200 —Ö–≤–∏–ª–∏–Ω
    }

    // –ó–∞–ø—É—Å–∫ —Å–µ–∫—É–Ω–¥–æ–º—ñ—Ä–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    function startStopwatch() {
        loadFromLocalStorage(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –∑ localStorage
        stopwatchInterval = setInterval(updateNumberAndTimer, 1000); // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É
        startNotificationTimer(); // –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–∞–π–º–µ—Ä –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        displayApiKey(); // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ API –∫–ª—é—á
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ API –∫–ª—é—á

–∞
    document.getElementById('regenerate-key').addEventListener('click', () => {
        const newApiKey = generateApiKey();
        localStorage.setItem('apiKey', newApiKey); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–æ–≤–∏–π –∫–ª—é—á –≤ localStorage
        displayApiKey(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è API –∫–ª—é—á–∞
    });

    // –ü–æ—á–∏–Ω–∞—î–º–æ —Å–µ–∫—É–Ω–¥–æ–º—ñ—Ä
    startStopwatch();
    </script>

</body>
</html>
